<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ course.title }}</title>
    <style>
        .video-player {
            width: 100%;
            max-width: 800px;
            height: 450px;
        }
        .weeks-list, .topics-list, .quizzes-list {
            list-style-type: none;
        }
        .weeks-list li, .topics-list li, .quizzes-list li {
            cursor: pointer;
            margin: 5px 0;
            color: blue;
            text-decoration: underline;
        }
        .topics-list {
            display: none;
        }
    </style>
    <script>
        function loadVideo(topicId, videoUrl) {
            const videoPlayer = document.getElementById('video-player');
            videoPlayer.src = videoUrl;

            fetch(`/course/{{ course.id }}/topic/${topicId}/`)
                .then(response => response.json())
                .then(data => {
                    console.log(data.message);
                    if (data.unlocked_quizzes) {
                        const quizzesList = document.getElementById('quizzes-list');
                        quizzesList.innerHTML = '';  // Clear the existing list
                        data.unlocked_quizzes.forEach(quiz => {
                            const li = document.createElement('li');
                            const link = document.createElement('a');
                            link.href = `/quiz/${quiz.id}/`;
                            link.textContent = quiz.title;
                            li.appendChild(link);
                            quizzesList.appendChild(li);
                        });
                    }
                });
        }

        function showTopics(weekId) {
            document.querySelectorAll('.topics-list').forEach(function(list) {
                list.style.display = 'none';
            });
            document.getElementById('topics-' + weekId).style.display = 'block';
        }
    </script>
</head>
<body>
    <h1>{{ course.title }}</h1>
    <div>
        <video id="video-player" class="video-player" controls>
            Your browser does not support the video tag.
        </video>
    </div>
    <ul class="weeks-list">
        {% for week in weeks %}
            <li onclick="showTopics({{ week.id }})">{{ week.title }}</li>
            <ul id="topics-{{ week.id }}" class="topics-list">
                {% for topic in week.topics.all %}
                    <li onclick="loadVideo({{ topic.id }}, '{{ topic.video.url|escapejs }}')">{{ topic.title }}</li>
                {% endfor %}
            </ul>
        {% endfor %}
    </ul>
    <div>
        <h2>Unlocked Quizzes</h2>
        <ul id="quizzes-list" class="quizzes-list">
            {% for quiz in quizzes %}
                <li><a href="{% url 'display_quiz' quiz.id %}">{{ quiz.title }}</a></li>
            {% endfor %}
        </ul>
    </div>
</body>
</html>
